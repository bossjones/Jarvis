<html>
<header>
	<title>HoloDeck Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" type="text/css" href="dynamictabtest.css">
</header>
<body>
	<div id="page">
  	<ul class='tabs'>
  		<li>Tab 1</li>
  		<li>Tab 2</li>
  		<li>Tab 3</li>
  		<li>Tab 4</li>
  	</ul>
  	
    <div id="content">
      <ul id='tab1' class='tabcontent'>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
        <li data-effect="forest" data-color="red"><img src="img/forest.png" /><label>Forest</label></li>
      </ul>
      <ul id='tab2' class='tabcontent'>
        <li>This is the 2nd tab.</li>
      </ul>
      <ul id='tab3' class='tabcontent'>
        <li>And this is the 3rd tab.</li>
      </ul>
      <ul id='tab4' class='tabcontent'>
        <li>LAST TAB</li>
      </ul>
  	</div>
  </div>
	
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="http://www.google.com/jsapi"></script>
  <script src="http://jquery-json.googlecode.com/files/jquery.json-2.2.min.js"></script>
  <script src="http://jquery-websocket.googlecode.com/files/jquery.websocket-0.0.1.js"></script>
  <script src="hammer.min.js"></script>
	<script>
    $(document).ready(function() {
      var swiping = false;
      var currentTab = 1;
      var maxTab = $(".tabs li").length;
      document.body.addEventListener('touchmove', function(e){ e.preventDefault(); });
      /* =====Set up elements===== */
      var contentWidth = $('#content').width();
      $("#content ul").width(contentWidth).each(function(index) {
        $(this).css('left', contentWidth * index);
      });
      $('.tabs li:nth-child(1)').addClass('active');
      var tileWidth = $('.tabcontent li').outerWidth();
      $('.tabcontent li').css({'height':tileWidth}); // make the icon elements square

      /* =====Web sockets interface====== */
      var ws = $.websocket("ws://localhost:8880/echo", {
        events: {
          say: function(e) {
            alert("message received!");
            dataTEMP = e.data;

            //adds items to tabs
            for (i in dataTEMP) {
              for(j in dataTEMP[i]) {
                $("#"+i).append('<li id="'+dataTEMP[i][j]['id']+'" class="tabcontentli">'+dataTEMP[i][j]['text']+'</li>');
              }
            }
          }
        }
      });
      
      /* ======Interactions===== */
      var element = document.getElementById('content');
      var options = {
        dragLockToAxis: true,
        dragBlockHorizontal: true
      };
      var hammerpos;
      var hammertime = new Hammer(element, options);
      hammertime.on("dragleft swipeleft", function(ev) {
        swiping = true;
        hammerpos = -contentWidth*(currentTab-1) + ev.gesture.deltaX;
        $("#content").css('margin-left', hammerpos);
      });
      hammertime.on("dragright swiperight", function(ev) {
        swiping = true;
        hammerpos = -contentWidth*(currentTab-1) + ev.gesture.deltaX;
        $("#content").css('margin-left', hammerpos);
      });
      hammertime.on("release", function(ev) {
        if (hammerpos < -contentWidth*(currentTab-0.9) && currentTab < maxTab) {
          currentTab += 1;
        } else if (hammerpos > -contentWidth*(currentTab-1.1) && currentTab > 1) {
          currentTab -= 1;
        }
        // move to next tab or reset to current tab
        hammerpos = -contentWidth*(currentTab-1);
        $(".tabs li:nth-child(" + currentTab + ")").click();

        setTimeout(function() { swiping = false; }, 100);
      });



      $( ".tabcontent li" ).click(function() {
        if (swiping) return;
        // TODO - send code to server
      	/**
      	var cID ={"clicked":event.target.id};
      	jCID = JSON.stringify(cID);
      	ws.send(jCID);
      	*/
      	ws.send("whaat");
        return false;
      });

      $('.tabs li').click(function(){
        currentTab = $(this).prevAll().length + 1;
        var dist = Math.abs(($(".tabs li.active").prevAll().length+1) - currentTab);
        $(".tabs li").removeClass("active");
        $(".tabs li:nth-child(" + currentTab + ")").addClass("active");
        $("#content")
          .css('transition', 'margin 0.' + (dist*2) + 's ease')
          .css('margin-left', -contentWidth*(currentTab-1));
        setTimeout(function() {
          $("#content").css('transition', 'none');
        }, dist*205);
        return false;
      });
    });
	</script>
</body>
</html>